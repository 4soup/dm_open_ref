

<a name=/DM/preprocessor/define>
<h2>#define directive</h2>

<dl><dt><b>See also:</b>
<dd><a href=#/DM/preprocessor>preprocessor</a>
</dl>

<dl><dt><b>Format:</b>
<dd>#define Name Value
<dd>#define Name(Parameters) Value
</dl>

<dl><dt><b>Args:</b>
<dd>Name:  A macro definition.
<dd>Value: The value to substitute for Name.
<dd>Parameters:  Arguments to pass into the macro.
</dl>

<p>The #define statement creates a macro that is substituted for Name.
Substitution only applies to whole words.  Text inside of double or single
quotes is not processed for substitution, so <code>"This is BIG."</code> would
not be modified even if a macro named BIG were defined.  That is different
from <code>"This is [BIG]."</code>, where BIG is an embedded expression, which
does get processed for macro substitution.

<h3>Example:</h3>
<xmp>
#define DAY   0
#define NIGHT 1
var/daytime = NIGHT  //daytime = 1
</xmp>

<h3>Example:</h3>
<xmp>
#define SQR(X) ((X)*(X))
var/x = SQR(2)       //x = ((2)*(2)) = 4
</xmp>

<p>Note that it's usually important to use parentheses around any arguments
you use in a macro. Otherwise strange results may occur if you use an
expression such as 2+3. In the SQR(X) example, if there were no parentheses
around each X then the expansion of the macro would be (2+3*2+3). Since the *
operator has a higher precedence than + the result is 11, not 25 as expected.
It's equally important to put parentheses around the entire macro for the
same reason.

<h3>Variadic macros</h3>

<p>The last parameter of a macro can end in <tt>...</tt> which means that it
and all other arguments following it count as a single argument. This is
called a variadic macro because it lets you use a variable number of
arguments. The last parameter will also become optional.

<h3>Example:</h3>
<xmp>
#define DEFAULT_LIST(n, items...) if(!n) n = list(items)
</xmp>

<h3><tt>#var</tt> to string</h3>

<p>In a macro's body, if you precede a parameter by <tt>#</tt>, the
replacement value will be turned into a string.  For instance, 2 would become
"2".

<h3>Example:</h3>
<xmp>
#define DEBUG_VAR(v) world.log << "[#v] = [v]"
DEBUG_VAR(usr.x)    // world.log << "usr.x = [usr.x]"
</xmp>

<h3><tt>##var</tt> concatenation</h3>

<p>A parameter preceded by <tt>##</tt> in the macro body is substituted
directly, without any spaces. If you use this with the last argument in a
variadic macro, any preceding spaces and a comma (if found) will be removed
if the replacement is empty.

<h3>Example:</h3>
<xmp>
#define MACROVAR(k) var/macro_state_##k
// MACROVAR(right) becomes var/macro_state_right

#define PREFIX_LIST(x, y...) list(x, src, ##y)
// PREFIX_LIST(1, 2, 3) becomes list(1, src, 2, 3)
// PREFIX_LIST(4) becomes list(4, src)
</xmp>

<h3><tt>n###var</tt> repeat</h3>

<p>Using <tt>###</tt> in the macro body, preceded by a number, will repeat the
replacement a certain number of times.

<h3>Example:</h3>
<xmp>
#define SAYTWICE(t) 2###t
#define TOTEXT(t) #t
world << "[TOTEXT(SAYTWICE(hi))]"   // world << "hihi"
</xmp>

