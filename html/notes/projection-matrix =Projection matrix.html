

<a name=/{notes}/projection-matrix toc="Projection matrix">
<h2 byondver=514>Projection matrix</h2>

<dl><dt><b>See also:</b>
<dd><a href=#/{notes}/particles>Particle effects</a>
<dd><a href=#/atom/var/transform>transform var (atom)</a>
<dd><a href=#/matrix>matrix</a>
<dd><a href=#/{notes}/color-matrix>Color matrix</a>
</dl>

<p>Note: Currently this feature applies only to particle effects, using the
<tt>transform</tt> var.

<p>Normally icons in BYOND can only be transformed in 2D, using a simple 3x3
matrix. This is represented by the <tt>/matrix</tt> object, which cuts off the
last column because it isn't used. However particles can have coordinates in x,
y, and z, and the whole particle set can be given a transformation matrix that
handles all three dimensions.

<h3>Simple 2D transforms</h3>

<p>The easiest transformation for particles is a simple 2D one, which you can
do by setting the particle datum's <tt>transform</tt> var to a <tt>/matrix</tt>
object.

<pre>          a d 0
x y 1  *  b e 0  =  x' y' 1
          c f 1</pre>

<p>When an x,y point is multiplied by the matrix, it becomes the new point
x',y'. This is equivalent to:

<pre>x' = a*x + b*y + c
y' = d*x + e*y + f</pre>

<p>This is called an <b>affine transform</b> because all the operations are
"linear" in math terms. (That is, every term in the formula above has a single
variable, not raised to a higher power than 1.)

<h3>3x4 matrix (x,y,z with translation)</h3>

<p>3D affine transforms of this type are also affine transformations. There is
no special object for this so a list is used (see below).

<pre>            xx xy xz 0
x y z 1  *  yx yy yz 0  =  x' y' z' 1
            zx zy zz 0
            cx cy cz 1</pre>

<p>The way to read the vars above is that the first letter says what input
component is being transformed (x,y,z, or c for "constant"), and the second
letter is the output component.

<pre>x' = xx*x + yx*y + zx*z + cx
y' = xy*x + yy*y + zy*z + cy
z' = xz*x + yz*y + zz*z + cz</pre>

<p>To use this kind of matrix, you can cut off the 4th column and provide the
values in a list form, in row-major order:

<xmp>list(xx,xy,xz, yx,yy,yz, zx,zy,zz, cx,cy,cz)</xmp>

<p>Note the 4th row is also optional.</p>

<h3>4x4 matrix (x,y,z,w with projection)</h3>

<p>This is the most interesting matrix, since if you use all 4 columns you're
actually altering an "axis" called w. This isn't a real axis, but is just a
number that the resulting vector will be divided by.

<pre>            xx xy xz xw
x y z 1  *  yx yy yz yw  =  x'w' y'w' z'w' w'
            zx zy zz zw
            wx wy wz ww

w' = xw*x + yw*y + zw*z + ww
x' = (xx*x + yx*y + zx*z + wx) / w'
y' = (xy*x + yy*y + zy*z + wy) / w'
z' = (xz*x + yz*y + zz*z + wz) / w'</pre>

<p>In a regular affine transform, w always stays at 1. In projection you can
think of w as a distance from the "camera". 1 is where objects are their
"normal" size. If you make the z value affect w' by setting zw, you basically
make an object look smaller at higher z values.

<p>This is a simple projection matrix where x,y,z are left untouched, but
there's a projection effect. The "D" value is how far away the "camera" is
from z=0, so a point at z=D looks like it's twice as far away.

<pre>
1  0  0  0
0  1  0  0
0  0  1  1/D
0  0  0  1
</pre>

<p>This 4x4 matrix is handled as a list just like the 3x4 affine matrix:

<xmp>list(xx,xy,xz,xw, yx,yy,yz,yw, zx,zy,zz,zw, wx,wy,wz,ww)</xmp>

