

<a name=/{notes}/particles toc="Particle effects">
<h2 byondver=514>Particle effects</h2>

<dl><dt><b>See also:</b>
<dd><a href=#/atom/movable/var/particles>particles (movable atom var)</a>
<dd><a href=#/{notes}/generators>Generators</a>
<dd><a href=#/proc/generator>generator proc</a>
<dd><a href=#/{notes}/projection-matrix>Projection matrix</a>
<dd><a href=#/{{appendix}}/stddef%2edm>stddef.dm file</a>
</dl>

<p>A particle set is a special effect, whose computations are handled entirely
on the client, that spawns and tracks multiple pixels or icons with a
temporary lifespan. Examples of this might be confetti, sparks, rocket
exhaust, or rain or snow. Particles are rendered on a special surface and that
gets attached to an obj or a mob like an overlay.

<p>Particles can exist in 3 dimensions instead of the usual 2, so a particle's
position, velocity, and other values may have a z coordinate. To make use of
this z coordinate, you can use a <a href=#/{notes}/projection-matrix>projection
matrix</a>. (The value of the z coordinate must be between -100 and
100 after projection. Otherwise it's not guaranteed the particle will be
displayed.)

<p>To create a particle set, use <tt>new</tt> to create a new
<tt>/particles</tt> datum, and then you can set the datum's vars. The vars can
be set to constant values, or generator functions that will allow the client
to choose from a range of values when spawning those particles. (The easiest
way to handle this is to create your own type that inherits from
<tt>/particles</tt>, and set up the parameters you'll want at compile-time.)

<p>After the datum is created, it can be assigned to an obj or mob using their
<tt>particles</tt> var. The particles will appear on the map wherever that obj
or mob appears.

<h3>Example:</h3>
<xmp>
particles/snow
    width = 500     // 500 x 500 image to cover a moderately sized map
    height = 500
    count = 2500    // 2500 particles
    spawning = 12    // 12 new particles per 0.1s
    bound1 = vector(-1000, -300, -1000)   // end particles at Y=-300
    lifespan = 600  // live for 60s max
    fade = 50       // fade out over the last 5s if still on screen
    // spawn within a certain x,y,z space
    position = generator("box", vector(-300,250,0), vector(300,300,50))
    // control how the snow falls
    gravity = vector(0, -1)
    friction = 0.3  // shed 30% of velocity and drift every 0.1s
    drift = generator("sphere", 0, 2)
obj/snow
    screen_loc = "CENTER"
    particles = new/particles/snow

mob
    proc/CreateSnow()
        client?.screen += new/obj/snow
</xmp>

<p>These are the vars that can be used in a particle set. "Tick" refers to a
BYOND standard tick of 0.1s.

<table class=codefirst>
<tr><th colspan=3>Particle vars that affect the entire set (generators are not allowed for these)</th></tr>
<tr><th>Var</th><th>Type</th><th>Description</th></tr>
<tr><td>width</td><td rowspan=2>num</td><td rowspan=2>Size of particle image in pixels</td></tr>
<tr><td>height</td></tr>
<tr><td>count</td><td>num</td><td>Maximum particle count</td></tr>
<tr><td>spawning</td><td>num</td><td>Number of particles to spawn per tick (can be fractional)</td></tr>
<tr><td>bound1</td><td>vector</td><td>Minimum particle position in x,y,z space; defaults to list(-1000,-1000,-1000)</td></tr>
<tr><td>bound2</td><td>vector</td><td>Maximum particle position in x,y,z space; defaults to list(1000,1000,1000)</td></tr>
<tr><td>gravity</td><td>vector</td><td>Constant acceleration applied to all particles in this set (pixels per squared tick)</td></tr>
<tr><td>gradient</td><td><a href=#/{notes}/color-gradient>color gradient</a></td><td>Color gradient used, if any</td></tr>
<tr><td>transform</td><td><a href=#/{notes}/projection-matrix>matrix</a></td><td>Transform done to all particles, if any (can be higher than 2D)</td></tr>
<tr><th colspan=3>Vars that apply when a particle spawns</th></tr>
<tr><td>lifespan</td><td>num</td><td>Maximum life of the particle, in ticks</td></tr>
<tr><td>fade</td><td>num</td><td>Fade-out time at end of lifespan, in ticks</td></tr>
<tr><td>fadein</td><td>num</td><td>Fade-in time, in ticks</td></tr>
<tr><td>icon</td><td>icon</td><td>Icon to use, if any; no icon means this particle will be a dot<br/>Can be assigned a weighted list of icon files, to choose an icon at random</td></tr>
<tr><td>icon_state</td><td>text</td><td>Icon state to use, if any<br/>Can be assigned a weighted list of strings, to choose an icon at random</td></tr>
<tr><td>color</td><td>num or color</td><td>Particle color (not a color matrix); can be a number if a gradient is used</td></tr>
<tr><td>color_change</td><td>num</td><td>Color change per tick; only applies if gradient is used</td></tr>
<tr><td>position</td><td>num</td><td>x,y,z position, from center in pixels</td></tr>
<tr><td>velocity</td><td>num</td><td>x,y,z velocity, in pixels</td></tr>
<tr><td>scale</td><td>vector (2D)</td><td>Scale applied to icon, if used; defaults to list(1,1)</td></tr>
<tr><td>grow</td><td>num</td><td>Change in scale per tick; defaults to list(0,0)</td></tr>
<tr><td>rotation</td><td>num</td><td>Angle of rotation (clockwise); applies only if using an icon</td></tr>
<tr><td>spin</td><td>num</td><td>Change in rotation per tick</td></tr>
<tr><td>friction</td><td>num</td><td>Amount of velocity to shed (0 to 1) per tick, also applied to acceleration from drift</td></tr>
<tr><th colspan=3>Vars that are evalulated every tick</th></tr>
<tr><td>drift</td><td>vector</td><td>Added acceleration every tick; e.g. a circle or sphere generator can be applied to produce snow or ember effects</td></tr>
</table>

<p>The <tt>icon</tt> and <tt>icon_state</tt> values are special in that they can't be assigned a generator, but they can be assigned a constant icon or string, respectively, or a list of possible values to choose from like so:

<xmp>icon = list('confetti.dmi'=5, 'coin.dmi'=1)</xmp>

<p>The list used can either be a simple list, or it can contain weights as shown above.

<p>Changing a var on a particle datum will make changes to future particles.
For instance, you can set the datum's <tt>spawning</tt> var to 0 to make it
stop creating new particles. (Note: If you are changing a vector or color
matrix, such as <tt>gravity</tt>, you need to assign a new value. You can't
for instance set <tt>particles.gravity[2] = 0</tt> because it won't do
anything to update the particle stream.)

<p>The same particle datum can be assigned to more than one movable atom.
However the particles displayed by each atom will be different.

