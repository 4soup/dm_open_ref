

<a name=/DM/mouse toc="mouse handling">
<h2>mouse handling</h2>

<p>Various mouse actions may be handled by defining procedures either on the
client object or on the atomic object being manipulated.  Any of the following
procedures may be defined:

<ul>
<li><a href=#/client/proc/MouseDown>MouseDown()</a>
<li><a href=#/client/proc/MouseUp>MouseUp()</a>
<li><a href=#/client/proc/MouseDrag>MouseDrag()</a>
<li><a href=#/client/proc/MouseDrop>MouseDrop()</a>
<li><a href=#/client/proc/MouseEntered>MouseEntered()</a>
<li><a href=#/client/proc/MouseExited>MouseExited()</a>
<li><a href=#/client/proc/MouseMove>MouseMove</a>
<li><a href=#/client/proc/MouseWheel>MouseWheel</a>
<li><a href=#/client/proc/Click>Click()</a>
<li><a href=#/client/proc/DblClick>DblClick()</a>
</ul>

<p>In general, define only the procedures you need, because extra
communication overhead may be avoided when the compiler detects that you do
not care about certain events.

<p>The arguments used in mouse procs generally follow one of these forms:

<dl>
<dt>For Click(), DblClick(), MouseDown(), MouseUp(), MouseEntered(), MouseExited(), and MouseMove():</dt>
  <dd>client/Click(object, location, control, params)<br/>
  atom/Click(location, control, params)</dd>
<dt>For MouseDrag() and MouseDrop():</dt>
  <dd>client/MouseDrag(src_object, over_object, src_location, over_location, src_control, over_control, params)<br/>
  atom/MouseDrag(over_object, src_location, over_location, src_control, over_control, params)</dd>
<dt>For MouseWheel():</dt>
  <dd>client/MouseWheel(object, delta_x, delta_y, location, control, params)<br/>
  atom/MouseWheel(delta_x, delta_y, location, control, params)</dd>
</dl>

<p>The <tt>location</tt> argument varies with the type of control. For the map, it
will be the turf where the mouse action happened. For info controls (statpanels),
it will be the name of the statpanel where the action happened. For grid controls,
it will be the cell where the action happened. For others controls it may vary,
but most will leave this blank.

<p>The <tt>control</tt> argument is the ID of the skin control where the
action happened, such as <tt>"mappane.map"</tt> or <tt>"mainwindow.banner"</tt>.

<p>The <tt>params</tt> argument is text, and can be converted to a list using
<a class=code href=#/proc/params2list>params2list()</a>. It may contain any of
the following properties, which will only be set if they are used:

<ul>
<li>icon-x, icon-y: Pixel coordinates within the icon, in the icon's coordinate space
<li>screen-loc: Pixel coordinates in screen_loc format ("[tile_x]:[pixel_x],[tile_y]:[pixel_y]")
<li>left, middle, right: Mouse buttons pressed, held, or released in this action (see compatibility note below)
<li byondver=514>button: Mouse button pressed or released in this action (see compatibility note below)
<li>ctrl, shift, alt: Keys held down during the mouse action
<li>drag-cell, drop-cell: Cells involved if using a Grid control
<li>drag: The button used for dragging (only sent for unrelated mouse up/down messages during a drag)
<li>link: If the mouse is over a link in maptext, or this event is related to clicking such a link
<li>vis-x, vis-y: Pixel coordinates relative to the icon's position on screen
</ul>

<p>The icon-x/y coordinates are integers, and try to point to the actual
pixel in the icon before any atom transforms are done; i.e. if the icon
were scaled up to 3 times its size using the transform var, then a
3&times;3 region of pixels would all have the same icon-x/y values. The lower
left pixel of the icon is 1,1. The vis-x/y parameters are screen-based, and
their origin (1,1) is wherever the lower left corner of the icon is rendered.

<p>Note: vis-x/y will not be included in the parameters if they are the same
as icon-x/y.

<p>If the mouse is over an overlay, icon-x/y and vis-x/y are relative to the
parent object, not the overlay icon itself, so it's possible to have value
outside of the normal range of 1,1 to [width],[height].

<p>The mouse pointer may be customized as well.  The following variables all
deal with the appearance of the pointer.  They do not control what actions may
be taken by the user, but they provide hints to the user about what actions
may work.

<ul>
<li><a href=#/client/var/mouse_pointer_icon>mouse_pointer_icon</a>
<li><a href=#/atom/var/mouse_over_pointer>mouse_over_pointer</a>
<li><a href=#/atom/var/mouse_drag_pointer>mouse_drag_pointer</a>
<li><a href=#/atom/var/mouse_drop_pointer>mouse_drop_pointer</a>
<li><a href=#/atom/var/mouse_drop_zone>mouse_drop_zone</a>
<li><a href=#/atom/var/mouse_opacity>mouse_opacity</a>
</ul>

<p>When selecting a mouse pointer, you may provide your own custom icon or use
one of the <a href=#/DM/mouse/pointers>built-in pointers</a>.

<p class=compatibility>Note: Older games compiled prior to BYOND 4.0 had a
different format for the <tt>MouseDown()</tt> and <tt>MouseUp()</tt> procs.
These used <tt>icon_x</tt> and <tt>icon_y</tt> as arguments, but
<tt>control</tt> and <tt>params</tt> have replaced them.

<p class=compatibility>Note: Games compiled before version 514 did not have
the <tt>button</tt> parameter, so they handled the <tt>left</tt>,
<tt>middle</tt>, and <tt>right</tt> parameters differently. In old versions,
only the button used in the action (left, middle, right) was included as a
parameter; now all buttons being held or changed are included, and
<tt>button</tt> is the mouse button that changed.

