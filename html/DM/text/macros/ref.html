

<a name=/DM/text/macros/ref>
<h2 byondver=513>ref text macro</h2>

<dl><dt><b>See also:</b>
<dd><a href=#/client/proc/Topic>Topic proc (client)</a>
<dd><a href=#/DM/text/macros/icon>icon text macro</a>
<dd><a href=#/proc/locate>locate proc</a>
<dd><a href=#/DM/text/macros>macros (text)</a>
<dd><a href=#/datum/var/tag>tag var (datum)</a>
</dl>

<p>The <code>\ref</code> text macro inserts a unique identification number
or text string for the following embedded object (inside []'s).

<p>In older versions of BYOND, if an object had a tag, that was used instead.
However this has often proved to be problematic, so anything compiled from
version 512 onward should expect to output a reference number.  If you want
to use the tag, which stands a better chance of still being valid if the
object is deleted and recreated (like in a world reboot), you can output the
object's tag explicitly.

<p>The primary use for object references embedded in text is in topic links.
This allows you to encode a reference to an object in the href value of a
hyperlink.  (Just make sure the object does not get deleted before the user
executes the link.  See <a href=#/DM/garbage>garbage collection</a>.)

<p>Topic links that contain a parameter "src" assigned to an object reference
are treated somewhat specially.  Unless you override client.Topic() to do
otherwise, the default behavior is to call the referenced object's own Topic()
procedure.

<h3>Example:</h3>
<xmp>
mob/verb/test()
   usr << "Click <a href=?src=\ref[src];action=start>here</a>!"
mob/Topic(href,href_list[])
   switch(href_list["action"])
      if("start")
         usr << "Starting the game..."
      else
         return ..()
</xmp>

<p>The above example uses an embedded reference to the player's own mob to
create a link to a topic handled by that mob's Topic() proc.  The
<code>href_list</code> parameter is simply the result of
<code>params2list(href)</code>.

<p>In that example, the embedded reference was automatically converted back
into an object (dereferenced) for you.  If you embed references to additional
objects in the href data, you would have to dereference those yourself using
the locate() instruction.

<h3>Browser images</h3>

<p>In output for browser controls, you can use <tt>\ref[object]</tt> as the src
parameter for an &lt;img&gt; tag. The object can be an
<a href=#/atom/var/appearance>appearance</a>, an icon, or an atom or image.

<p>If the ref string is for an icon, you can add an HTML query string after
the icon reference.

<h3>Example:</h3>
<xmp>
player << browse({"
    <html><body>
    <img src="\ref[icon]?state=hungry&dir=[EAST]">
    </body></html>"})
</xmp>

<p>The query string can include any of the following (separated by &amp; characters):

<dl class=codedt>
<dt>sheet</dt><dd>Display all matching frames as a sprite sheet; otherwise the first matching frame is used</dd>
<dt>state=<i>ICON_STATE</i></dt><dd>Use a specific icon state; be sure to <a class=code href=#/proc/url_encode>url_encode</a> it)</dd>
<dt>moving=<i>M</i></dt><dd>Specify whether to choose only moving (M=1) or non-moving (M=0) states</dd>
<dt>dir=<i>DIR</i></dt><dd>Choose only frames with a specific direction (this should be a number, not text, so for instance <tt>dir=[NORTH]</tt>)</dd>
<dt>frame=<i>N</i></dt><dd>Choose the Nth animation frame in an animated icon</dd>
</dl>

